<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Instead of spending hours on setting up a dev env in your local machine just for a single bughunt, do it inside a container and delete the container and image after the job. Zero Bloat."><title>Debugging a python program inside of a container</title>
<link rel=canonical href=https://ankitp.com.np/p/debugging-a-python-program-inside-of-a-container/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Debugging a python program inside of a container"><meta property='og:description' content="Instead of spending hours on setting up a dev env in your local machine just for a single bughunt, do it inside a container and delete the container and image after the job. Zero Bloat."><meta property='og:url' content='https://ankitp.com.np/p/debugging-a-python-program-inside-of-a-container/'><meta property='og:site_name' content='Ankit Paudel'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='python'><meta property='article:tag' content='docker'><meta property='article:tag' content='container'><meta property='article:tag' content='debug'><meta property='article:published_time' content='2024-06-22T10:45:58+05:45'><meta property='article:modified_time' content='2024-06-22T10:45:58+05:45'><meta name=twitter:title content="Debugging a python program inside of a container"><meta name=twitter:description content="Instead of spending hours on setting up a dev env in your local machine just for a single bughunt, do it inside a container and delete the container and image after the job. Zero Bloat."><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu10216697898764085565.jpg width=300 height=313 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ðŸ”Ž</span></figure><div class=site-meta><h1 class=site-name><a href=/>Ankit Paudel</a></h1><h2 class=site-description>Code, Cloud and AI; Taming all three</h2></div></header><ol class=menu-social><li><a href=https://github.com/ankitpaudel20 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://github.com/in/ankitpaudel20 target=_blank title=Linkedin rel=me><svg viewBox="0 0 48 48" width="144" height="144" stroke="currentcolor" fill="none" stroke-width="1"><path d="M11.5 6C8.4802259 6 6 8.4802259 6 11.5v25C6 39.519774 8.4802259 42 11.5 42h25c3.019774.0 5.5-2.480226 5.5-5.5v-25C42 8.4802259 39.519774 6 36.5 6h-25zm0 3h25c1.398226.0 2.5 1.101774 2.5 2.5v25c0 1.398226-1.101774 2.5-2.5 2.5h-25C10.101774 39 9 37.898226 9 36.5v-25C9 10.101774 10.101774 9 11.5 9zm4 4a2.5 2.5.0 000 5 2.5 2.5.0 000-5zM14 20C13.447 20 13 20.447 13 21V34C13 34.553 13.447 35 14 35h3C17.553 35 18 34.553 18 34V21C18 20.447 17.553 20 17 20H14zm7 0C20.447 20 20 20.447 20 21V34C20 34.553 20.447 35 21 35h3C24.553 35 25 34.553 25 34V26.5c0-1.379 1.121-2.5 2.5-2.5S30 25.121 30 26.5V34C30 34.553 30.447 35 31 35h3C34.553 35 35 34.553 35 34V26c0-3.309-2.691-6-6-6C27.462 20 26.063 20.586016 25 21.541016V21C25 20.447 24.553 20 24 20H21z"/></svg></a></li><li><a href=https://twitter.com/ankitpaudel20000 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#premises>Premises</a></li></ol></li><li><a href=#the-problem>The Problem</a></li><li><a href=#the-solution>The solution</a><ol><li><a href=#debugpy-to-rescue>Debugpy to rescue</a><ol><li><a href=#running-debugpy-inside-the-container>Running debugpy inside the container</a></li><li><a href=#connecting-your-vscode-instance-with-the-debugpy-running-inside-of-the-container>Connecting your vscode instance with the debugpy running inside of the container</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/python/>Python
</a><a href=/categories/docker/>Docker</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/debugging-a-python-program-inside-of-a-container/>Debugging a python program inside of a container</a></h2><h3 class=article-subtitle>Instead of spending hours on setting up a dev env in your local machine just for a single bughunt, do it inside a container and delete the container and image after the job. Zero Bloat.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 22, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><h1 id=debugging-python-inside-of-a-docker-container>Debugging python inside of a docker container</h1><h3 id=premises>Premises</h3><p>Lets say you are working on some legacy python project which has very obscure and obsolete dependencies and you now want to debug it.
First lets pray to god that, this day does not come to anybody but if you are working on some project without standard practices on package management, this kind of situation is not uncommon.</p><h2 id=the-problem>The Problem</h2><p>Making a local dev envs.</p><ul><li>Even though pyenv and poetry to name a few is able to install different versions of python along with old deps, what if the packages are so old even pip does not have them.<ul><li>A few old python packages do delete old version from pipy instead of yanking them that will cause the old programs to even stop running in the near future.</li></ul></li><li>The next problem is bloat if you have multiple of these shitty projects then you would not want your whole system to endure the cost of multiple old and obsolete python versions in the long run. Lets admit it nobody remembers to uninstall the things that we installed just to make things to working, instead we leave it in our system till we get out of space or some other things break due to that. The latter case will be the most troublesome because it might take another full day just to know the reason why your new program is not working and that the problem was you having an old version of something else.</li></ul><h2 id=the-solution>The solution</h2><p>My solution to this problem is to debug inside of a container.
You replicate the environment that your system was running on, inside of a container.</p><ul><li><p>This is a breeze if you already had your program containerized.</p><ul><li>Get the container that has been running this whole time in production. Either docker pull or form sysadmin.</li><li>Here is one of the answer on how to load the image to your local docker instance if you don&rsquo;t have access to docker pull image:</li><li><a class=link href=https://stackoverflow.com/questions/37905763/how-do-i-download-docker-images-without-using-the-pull-command target=_blank rel=noopener>https://stackoverflow.com/questions/37905763/how-do-i-download-docker-images-without-using-the-pull-command</a></li></ul></li><li><p>But if you had not done so before, you need answers to following things from your sysadmin or anyone who has access to the running system:</p><ul><li>What is the OS? if Its Windows, Goodluck on that. Go the usual pyenv/poetry route.</li><li>The output of pip freeze and python version. Get hands on requirements.txt.</li></ul></li><li><p>Now containerize your application.</p><ul><li>Make a simple docker image having following steps:</li><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=c>## The name and versions should be the one from your production system.</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>## It should be available in dockerhub as they normally have older images too.</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> debian:&lt;tag&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>## Install the required libraries. apt is for debian.</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt update <span class=o>&amp;&amp;</span> apt install .....<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>## Install debugpy to initialize remote debugging session.</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install debugpy<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./requirements.txt /requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>## Some other pip installs you have some custom python packages to install.</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>## This so that you can get shell access to the docker without doing docker exec anything</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;bash&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>If you have a bit of complex program requirements like requiring redis or some other things then you can use a <code>docker-compose.yaml</code> file. This was the case in my case. Feel free to take reference from dockercompose below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dev-container</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  	</span><span class=c>## I have this because I have access to do docker pull.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>## If you have to build from dockerfile, you can give this any name,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>## then uncomment the build part below</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>us-docker.pkg.dev/&lt;project_id&gt;/us.gcr.io/&lt;image_name&gt;:&lt;image_tag&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># build:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#   context: .</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#   dockerfile: Dockerfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#   args:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#     - GITLAB_DEPLOY_TOKEN=&lt;GITLAB_TOKEN&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>## I needed this because I had custom old package to install from gitlab&#39;s package registry.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./app:/app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./service_account.json:/srv/key.json</span><span class=w> </span><span class=c>## this was required to access google specific resource inside the program</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;.env&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>GOOGLE_APPLICATION_CREDENTIAL_PATH=/srv/key.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>FLASK_APP=app.app:app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>## uncomment this instead of network_mode : host if you have the ports inside the container occupied.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># ports:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#   - 8080:8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>network_mode</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;host&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>stdin_open</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tty</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;bash&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>## my program required redis too.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis-master</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># ports:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#   - &#34;6379:6379&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>redis-server --appendonly yes --requirepass 123456789</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>network_mode</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;host&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;.env&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=debugpy-to-rescue>Debugpy to rescue</h3><ul><li>Debugpy a implementation of a <strong><a class=link href=https://microsoft.github.io/debug-adapter-protocol/ target=_blank rel=noopener>Debug Adapter Protocol</a></strong> for python which is protocol developed my microsoft that defines abstract rules of communication between a IDE or text editor and the debugger. (PDB in our instance)</li><li>Its a remote debugging application developed by microsoft and used in vscode for debugging.</li><li>We then do <code>docker run --name dev-container --env-file .env --network host -it -v &lt;local_source_code_path>:&lt;path_inside_container> &lt;image_name></code></li><li>Now that your docker container is running, you can attach your current shell to the container:
<code>docker attach &lt;container_name></code><ul><li>container name is the name you gave while doing docker run. If you had skipped that part, docker will give you a random name. To get that name, you do <code>docker ps</code> to show currently running container and get the random name from that.</li></ul></li><li><h4 id=running-debugpy-inside-the-container>Running debugpy inside the container</h4></li><li>Once you got inside of the shell of the running container, you run the program.
<code>python -m debugpy --listen 0.0.0.0:5678 -m flask run --host='0.0.0.0' --port=8080</code></li><li>This is for flask application but if you are running something else modify it accordingly.
For more information on debugpy and its options view its <a class=link href=https://github.com/microsoft/debugpy target=_blank rel=noopener>github page</a>.</li><li><h4 id=connecting-your-vscode-instance-with-the-debugpy-running-inside-of-the-container>Connecting your vscode instance with the debugpy running inside of the container</h4></li><li>Open vscode in the dir you mounted or the project dir.</li><li>Make a new launch.json or make vscode make it automaticaly for you.
<img src=/p/debugging-a-python-program-inside-of-a-container/image.png width=542 height=192 srcset="/p/debugging-a-python-program-inside-of-a-container/image_hu16357426629487978787.png 480w, /p/debugging-a-python-program-inside-of-a-container/image_hu7910360251774123616.png 1024w" loading=lazy alt=debug_pane class=gallery-image data-flex-grow=282 data-flex-basis=677px><ul><li>Click on <code>Create a launch.json file > Python Debugger > Remote Attach</code>.</li><li>Leave the hostname on <code>localhost</code> and port to 5678 because we set it while launching debugpy in previous step.<ul><li>We are keeping hostname to localhost and port to 5678 because we have <code>--network host</code> while running docker container. If 5678 is somehow occupied in your system then forward the port 5678 to some other available port like 9874 in your system by using <code>-p &lt;local_port>:&lt;container_port></code> while doing docker run.</li></ul></li><li>Now you will get something like this in your <code>launch.json</code><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Use IntelliSense to learn about possible attributes.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// Hover to view descriptions of existing attributes.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;configurations&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Python Debugger: Remote Attach&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;debugpy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;request&#34;</span><span class=p>:</span> <span class=s2>&#34;attach&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;connect&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>5678</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;pathMappings&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;localRoot&#34;</span><span class=p>:</span> <span class=s2>&#34;${workspaceFolder}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;remoteRoot&#34;</span><span class=p>:</span> <span class=s2>&#34;.&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li>Fix the Path mappings with the paths you had while doing docker run in -v part. I had <code>-v ./app:/app</code> so I will change the <code>pathMapping</code> to something like:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;pathMappings&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;localRoot&#34;</span><span class=p>:</span> <span class=s2>&#34;${workspaceFolder}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;remoteRoot&#34;</span><span class=p>:</span> <span class=s2>&#34;.&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul></li><li>Now while the container and the program you want to debug inside is running with debugpy, you set breakpoints like you normally used to do clicking beside the line numbers.
<img src=/p/debugging-a-python-program-inside-of-a-container/image-1.png width=361 height=333 srcset="/p/debugging-a-python-program-inside-of-a-container/image-1_hu10191340369962095559.png 480w, /p/debugging-a-python-program-inside-of-a-container/image-1_hu12610747118726752422.png 1024w" loading=lazy alt=line_number class=gallery-image data-flex-grow=108 data-flex-basis=260px></li><li>Press F5 to launch the debugging session and try to run the program normally. You can send the request to the server if its http server or something like that.</li><li>Once the code execution hits breakpoint, your program will pause automatically at the breakpoint and you can inspect variables, invoke functions and others.</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/python/>Python</a>
<a href=/tags/docker/>Docker</a>
<a href=/tags/container/>Container</a>
<a href=/tags/debug/>Debug</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Ankit Paudel</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>